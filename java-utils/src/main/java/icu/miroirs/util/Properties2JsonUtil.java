package icu.miroirs.util;import com.alibaba.fastjson.JSONArray;import com.alibaba.fastjson.JSONObject;import java.util.List;import java.util.Properties;import java.util.Set;import java.util.stream.Collectors;/** * @Auther: ripley * @Date: 2021/9/3 09:27 * @Description: */public class Properties2JsonUtil {    public static JSONObject prop2Json(Properties properties) {        JSONObject json = new JSONObject();        Set<String> names = properties.stringPropertyNames();        for (String name:names) {            if (!name.contains(".")) {                json.put(name, properties.getProperty(name));                continue;            }            String[] objects = name.split("\\.");            String lastName = objects[objects.length - 1];            String key = name.replace("." + lastName, "");            if (!json.containsKey(key)){                json.put(key,new JSONObject());            }            JSONObject jsonKey = json.getJSONObject(key);            jsonKey.put(lastName,properties.getProperty(name));            json.put(key,jsonKey);        }        recJson(json);        return json;    }    public static void recJson(JSONObject object){        List<String> keySet = object.keySet().stream().collect(Collectors.toList());        for (String k: keySet) {            if (!k.contains(".")){                continue;            }            String[] split = k.split("\\.");            String lastName = split[split.length - 1];            String key = k.replace("." + lastName, "");            if (lastName.contains("[")&&lastName.endsWith("]")){                String[] arrays = lastName.split("\\[");                String arrKey = key +"."+ arrays[0];                if (!object.containsKey(arrKey)){                    object.put(arrKey,new JSONArray());                }                JSONArray array = object.getJSONArray(arrKey);                array.add(object.get(k));                object.put(arrKey,array);            }else {                if (!object.containsKey(key)){                    object.put(key,new JSONObject());                }                JSONObject jsonKey = object.getJSONObject(key);                jsonKey.put(lastName,object.get(k));                object.put(key,jsonKey);            }            object.remove(k);        }        long count = object.keySet().stream().filter(key -> key.contains(".")).count();        if (count> 0){            recJson(object);        }        long arrayCount = object.keySet().stream().filter(key -> key.contains("[") && key.endsWith("]")).count();        if (arrayCount > 0){            object.keySet().stream().filter(key -> key.contains("[") && key.endsWith("]")).collect(Collectors.toList()).forEach(key->{                String[] arrays = key.split("\\[");                String arrKey = arrays[0];                if (!object.containsKey(arrKey)){                    object.put(arrKey,new JSONArray());                }                JSONArray array = object.getJSONArray(arrKey);                array.add(object.get(key));                object.put(arrKey,array);                object.remove(key);            });        }        return;    }}